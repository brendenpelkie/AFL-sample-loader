<!DOCTYPE html>
<html>
    <head>
        <title>DevServer</title>
        <style>
            body {
                background-color: linen;
            }
            h3.centered {
                text-align:center;
            }
            ul.element {
                list-style-type: square;
                padding-left:0;
            }
            li.element {
                list-style-type: none;
                margin: 5px 0 0px 0;
                height: 35px;
                display: flex;
                justify-content: center;
                align-items: center;
                font-weight: bold;
            }
            li.queued {
                background: #33cccc;
                border-style: solid;
                border-color: #000000;
                border-width: 1px;
            }
            li.history {
                background: #669999;
                border-style: solid;
                border-color: #000000;
                border-width: 1px;
            }
            div.meta {
                display:flex;
                background: tan;
                border-style: solid;
                border-color: #000000;
                border-width: 1px;
                justify-content: center;
                align-items: center;
                font-weight: bold;
                margin: 0 15px 0 15px
            }
        </style>
        <script src="static/jquery-3.4.1.min.js"></script>
        <script>
            function update_queue(){
                $.get( "get_queue", function( result ) {
                    
                    task_history = result[0];
                        
                
                    var queue_num = 0;
                    ul_history = $("<ul class=element>");
                    for (var i=0, l=task_history.length; i<l; ++i) {
                        var meta_str = "meta" + queue_num;
                        ul_history.append(
                                            "<li class='element history' data-div=" + meta_str + ">" + 
                                            JSON.stringify(task_history[i]['task']) + 
                                            "</li>" +
                                            "<div class='hidden meta' id=" + meta_str + ">"+
                                            JSON.stringify(task_history[i]['meta']) + 
                                            "</div>" 
                        );
                        if ($('#' + meta_str).length) {
                            if ($('#' + meta_str).is(':visible')) {
                                ul_history.children().last().last().show();
                            } else {
                                ul_history.children().last().last().hide();
                            }
                        } else {
                            ul_history.children().last().last().hide();
                        }
                        queue_num += 1;
                    }

                    task_queue = result[1];
                    ul_queued = $("<ul class=element>");
                    for (var i=0, l=task_queue.length; i<l; ++i) {
                        var meta_str = "meta" + queue_num;
                        ul_queued.append(
                                            "<li class='element queued' data-div=" + meta_str + ">" + 
                                            JSON.stringify(task_queue[i]['task']) + 
                                            "</li>" +
                                            "<div class='hidden meta' id="+ meta_str + ">" + 
                                            JSON.stringify(task_queue[i]['meta']) + 
                                            "</div>" 
                        );
                        if ($('#' + meta_str).length) {
                            if ($('#' + meta_str).is(':visible')) {
                                ul_queued.children().last().last().show();
                            } else {
                                ul_queued.children().last().last().hide();
                            }
                        } else {
                            ul_queued.children().last().last().hide();
                        }
                        queue_num += 1;
                    }

                    $("#history").html(ul_history);
                    $("#queued").html(ul_queued);

                    $('li.element').on('click', function() {
                        $('div[id="' + $(this).data('div') + '"]').toggle(); 
                    });
               })
            };
            
            
            update_queue(); // This will run on page load
            setInterval(function(){ update_queue() }, 500); // this will run every 0.5 seconds  

    </script>
  </head>
  <div id="command-queue">
    <div id="history"></div>
    <h3 class="centered"> History</h3> 
    <hr/>
    <h3 class="centered"> Queued</h3> 
    <div id="queued"></div>
  </div>
</html>
